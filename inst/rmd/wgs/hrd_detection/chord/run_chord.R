require(BSgenome.Hsapiens.UCSC.hg38)
require(BSgenome.Hsapiens.1000genomes.hs37d5)
require(CHORD)
require(furrr)
require(future)
require(glue)
require(gpgr)
require(here)
require(kableExtra)
require(mutSigExtractor)
require(tidyverse)

s <- tibble::tribble(
  ~Alias, ~Prefix, ~Assembly,
  "CUP1163", "SBJ00568__SBJ00568_PRJ200418_L2000769", "hg38",
  "SFRC01198", "SBJ00582__SBJ00582_PRJ200421_L2000771", "hg38",
  "SFRC01285", "SBJ00583__SBJ00583_PRJ200423_L2000773", "hg38",
  "PM2078754", "SBJ00580__SBJ00580_MDX200153_L2000765", "hg38",
  "PM3056445", "SBJ00133__SBJ00133_MDX200150_L2000763", "hg38",
  "MB20-71", "SBJ00578__SBJ00578_PRJ200404_L2000747", "hg38",
  "PM8188522", "SBJ00576__SBJ00576_MDX200145_L2000739", "hg38",
  "PM3062657", "SBJ00571__SBJ00571_MDX200135_L2000737", "hg38",
  # "CUP1163", "SBJ00568__SBJ00568_PRJ200388_L2000685", "hg38",
  "PM8234379", "SBJ00572__SBJ00572_MDX200138_L2000717", "hg38",
  "CUP1170", "SBJ00573__SBJ00573_PRJ200397_L2000721", "hg38",
  "PMEX82291", "SBJ00564__SBJ00564_MDX200132_L2000670", "hg38",
  "PM3064119", "SBJ00557__SBJ00557_MDX200118_L2000617", "hg38",
  "PM3058367", "SBJ00551__SBJ00551_MDX200106_L2000601", "hg38",
  "PM637554",  "SBJ00552__SBJ00552_MDX200109_L2000603", "hg38",
  "PMEX81421", "SBJ00553__SBJ00553_MDX200112_L2000605", "hg38",
  "PM3067385", "SBJ00467__SBJ00467_MDX200074_L2000419", "hg38",
  "SFRC01273", "SBJ00346__SBJ00346_PRJ200268_L2000236", "hg38",
  "SFRC01249", "SBJ00367__SBJ00367_PRJ200339_L2000284", "hg38",
  "SFRC01278", "SBJ00468__SBJ00468_PRJ200344_L2000421", "hg38",
  "PM3061246", "SBJ00501__SBJ00501_MDX200085_L2000448", "hg38",
  "PM1109969", "SBJ00493__SBJ00493_MDX200082_L2000446", "hg38",
  "SFRC01252", "SBJ00503__SBJ00503_PRJ200347_L2000456", "hg38",
  "CUPD007", "CUPD007__DNA051766-CUPD007-T", "GRCh37",
  "SFRC01286", "SBJ00546__SBJ00546_PRJ200366_L2000573", "hg38",
  "SFRC01077", "SBJ00544__SBJ00544_PRJ200363_L2000571", "hg38",
  "SFRC01038", "SBJ00508__SBJ00508_PRJ200358_L2000503", "hg38",
  "PM3008047", "SBJ00545__SBJ00545_MDX200103_L2000579", "hg38",
  "PM3008047-run2", "SBJ00545-run2__SBJ00545_MDX200103_L2000579", "hg38",
  "PM4029661", "SBJ00526__SBJ00526_MDX200098_L2000516", "hg38",
  "PM3054576", "SBJ00507__SBJ00507_MDX200095_L2000501", "hg38",
  "SFRC01270", "SBJ00505__SBJ00505_PRJ200352_L2000460", "hg38",
  "PM3064948", "SBJ00496__SBJ00496_MDX200090_L2000452", "hg38",
  "PM3055963", "SBJ00495__SBJ00495_MDX200088_L2000450", "hg38",
  "SFRC01295", "SBJ00504__SBJ00504_PRJ200349_L2000458", "hg38",
  "PM3043473", "SBJ00193__SBJ00193_MDX190182_L1900907", "GRCh37",
  "P033", "2016_249_17_MH_P033__CCR170115b_MH17T002P033", "hg38",
  "P025", "2016_249_18_WH_P025__CCR180149_VPT-WH025-E", "hg38",
  "BALL10", "B_ALL_Case_10__MDX190025_B_ALL_Case_10T", "hg38",
  "CUP8", "CUP-Pairs8__PRJ180660_8_DNA009529_FFPE", "hg38",
  "SEQCII50", "SEQC-II-50pc__SEQC-II_Tumor_50pc", "hg38",
  "SFRC01073", "SFRC01073__PRJ180598_SFRC01073-S2T", "hg38",
  "SFRC01178", "SBJ00267__SBJ00267_PRJ200047_L2000059", "hg38",
  "SFRC01122", "SBJ00001__SBJ00001_PRJ190733_L1900931", "hg38",
  "SFRC01143", "SFRC01143__PRJ190190_SFRC01143_T", "GRCh37",
  "SFRC01160", "SFRC01160__PRJ190376_SFRC01160-S1-19-1434", "GRCh37",
  "SFRC01210", "SBJ00162__MDX190151", "GRCh37",
  "PM3056445", "PM3056445__MDX190101_DNA052297-T", "GRCh37",
  "PM3028142", "SBJ00286__SBJ00286_PRJ200069_L2000117", "hg38",
  "PM4024666", "SBJ00322__SBJ00322_MDX200054_L2000238", "hg38",
  "PM3061034", "SBJ00301__SBJ00301_MDX200046_L2000147", "hg38",
  "SFRC01258", "SBJ00281__SBJ00281_PRJ200061_L2000100", "hg38",
  "PM2293366", "SBJ00236__SBJ00236_MDX190218_L1901019", "hg38",
  "SFRC01180", "SBJ00303__SBJ00303_PRJ200200_L2000150", "hg38",
  "SFRC01260", "SBJ00304__SBJ00304_PRJ200202_L2000152", "hg38",
  "SFRC01265", "SBJ00308__SBJ00308_PRJ200214_L2000169", "hg38",
) %>%
  dplyr::rowwise() %>%
  dplyr::mutate(
    snvindel_vcf = file.path(here(glue("nogit/inputs/patients/snv/{Prefix}-somatic-ensemble-PASS.vcf.gz"))),
    sv_vcf = file.path(here(glue("nogit/inputs/patients/sv/{Prefix}-manta.vcf.gz")))
  )

future::plan(multicore)
tictoc::tic()
res <- seq_len(nrow(s)) %>%
  furrr::future_map(function(i) {
    cat(s$Alias[i], "\n")
    gpgr::run_chord(vcf.snv = s$snvindel_vcf[i],
                    vcf.sv = s$sv_vcf[i],
                    sample.name = s$Alias[i],
                    ref.genome = s$Assembly[i])
  })
tictoc::toc()
saveRDS(res, "chord_results_2020-09-27_vcfinput.rds")
